L.Control.MapCenterCoord=L.Control.extend({options:{position:"bottomleft",icon:!0,onMove:!1,template:"{y} | {x}",projected:!1,formatProjected:"#.##0,000",latlngFormat:"DD",latlngDesignators:!0},onAdd:function(t){return this.options.icon&&(this._iconEl=L.DomUtil.create("div","leaflet-control-mapcentercoord-icon leaflet-zoom-hide"),t.getPanes().overlayPane.appendChild(this._iconEl),t.on("viewreset",this._onReset,this),this._onReset()),this._container=L.DomUtil.create("div","leaflet-control-mapcentercoord"),L.DomEvent.disableClickPropagation(this._container),t.on("move",this._onMapMove,this),t.on("moveend",this._onMapMoveEnd,this),this._container.innerHTML=this._getMapCenterCoord(),this._container},onRemove:function(t){this.options.icon&&(t.getPanes().overlayPane.removeChild(this._iconEl),t.off("viewreset",this._onReset,this)),t.off("move",this._onMapMove,this),t.off("moveend",this._onMapMove,this)},_onReset:function(t){var o=this._map.latLngToLayerPoint(this._map.getCenter());L.DomUtil.setPosition(this._iconEl,o)},_onMapMove:function(t){if(this.options.icon){var o=this._map.latLngToLayerPoint(this._map.getCenter());L.DomUtil.setPosition(this._iconEl,o)}this.options.onMove&&(this._container.innerHTML=this._getMapCenterCoord())},_onMapMoveEnd:function(t){if(this.options.icon){var o=this._map.latLngToLayerPoint(this._map.getCenter());L.DomUtil.setPosition(this._iconEl,o)}this._container.innerHTML=this._getMapCenterCoord()},_getMapCenterCoord:function(){return this.options.projected?this._getProjectedCoord(this._map.options.crs.project(this._map.getCenter())):this._getLatLngCoord(this._map.getCenter())},_getProjectedCoord:function(t){return L.Util.template(this.options.template,{x:this._format(this.options.formatProjected,t.x),y:this._format(this.options.formatProjected,t.y)})},_getLatLngCoord:function(t){var o,n,e,i;return t.lng<0?t.lng_neg=!0:t.lng_neg=!1,t.lat<0?t.lat_neg=!0:t.lat_neg=!1,t.lng>180&&(t.lng=t.lng-360,t.lng_neg=!t.lng_neg),"DM"===this.options.latlngFormat?(n=(e=parseInt(t.lng))+"º "+this._format("00.000",60*(t.lng-e))+"'",o=(e=parseInt(t.lat))+"º "+this._format("00.000",60*(t.lat-e))+"'"):"DMS"===this.options.latlngFormat?(e=parseInt(t.lng),i=60*(t.lng-e),n=e+"º "+this._format("00",parseInt(i))+"' "+this._format("00.0",60*(i-parseInt(i)))+"''",e=parseInt(t.lat),i=60*(t.lat-e),o=e+"º "+this._format("00",parseInt(i))+"' "+this._format("00.0",60*(i-parseInt(i)))+"''"):(n=this._format("#0.00000",t.lng)+"º",o=this._format("##0.00000",t.lat)+"º"),L.Util.template(this.options.template,{x:(this.options.latlngDesignators&&t.lng_neg?n.substr(1):n)+(this.options.latlngDesignators?t.lng_neg?" W":" E":""),y:(this.options.latlngDesignators&&t.lat_neg?o.substr(1):o)+(this.options.latlngDesignators?t.lat_neg?" S":" N":"")})},_format:function(t,o){if(!t||isNaN(+o))return o;var n=(o="-"==t.charAt(0)?-o:+o)<0?o=-o:0,e=t.match(/[^\d\-\+#]/g),i=e&&e[e.length-1]||".",r=e&&e[1]&&e[0]||",";t=t.split(i);o=+(o=o.toFixed(t[1]&&t[1].length))+"";var s=t[1]&&t[1].lastIndexOf("0"),a=o.split(".");(!a[1]||a[1]&&a[1].length<=s)&&(o=(+o).toFixed(s+1));var l=t[0].split(r);t[0]=l.join("");var h=t[0]&&t[0].indexOf("0");if(h>-1)for(;a[0].length<t[0].length-h;)a[0]="0"+a[0];else 0==+a[0]&&(a[0]="");(o=o.split("."))[0]=a[0];var p=l[1]&&l[l.length-1].length;if(p){for(var g=o[0],_="",c=g.length%p,m=0,d=g.length;m<d;m++)_+=g.charAt(m),!((m-c+1)%p)&&m<d-p&&(_+=r);o[0]=_}return o[1]=t[1]&&o[1]?i+o[1]:"",(n?"-":"")+o[0]+o[1]}}),L.Map.mergeOptions({MapCenterCoordControl:!1}),L.Map.addInitHook(function(){this.options.MapCenterCoordControl&&(this.MapCenterCoordControl=new L.Control.MapCenterCoord,this.addControl(this.MapCenterCoordControl))}),L.control.mapCenterCoord=function(t){return new L.Control.MapCenterCoord(t)};